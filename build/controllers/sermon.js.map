{"version":3,"sources":["../../src/controllers/sermon.js"],"names":["exports","list","req","res","params","query","page","parseInt","perPage","per_page","SermonModel","apiQuery","select","then","sermon","status","json","data","catch","err","logger","error","send","errors","get","findById","sermonId","exec","post","Object","assign","body","cloudinary","uploader","upload","featured_img","folder","result","url","create"],"mappings":";;AAAA;;;;AACA;;;;AACA;;AAEA;;;;AACA;;;;;;AAEAA,QAAQC,IAAR,GAAe,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC3B,MAAMC,SAASF,IAAIE,MAAJ,IAAc,EAA7B;AACA,MAAMC,QAAQH,IAAIG,KAAJ,IAAa,EAA3B;;AAEA,MAAMC,OAAOC,SAASF,MAAMC,IAAf,EAAqB,EAArB,KAA4B,CAAzC;AACA,MAAME,UAAUD,SAASF,MAAMI,QAAf,EAAyB,EAAzB,KAAgC,EAAhD;;AAEAC,sBAAYC,QAAZ,CAAqBT,IAAIG,KAAzB,EACGO,MADH,CACU,4EADV,EAEGC,IAFH,CAEQ,UAACC,MAAD,EAAY;AAChBX,QAAIY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBD,cAAQ,GADW;AAEnBE,yCAAUH,MAAV;AAFmB,KAArB;AAID,GAPH,EAQGI,KARH,CAQS,UAACC,GAAD,EAAS;AACdC,qBAAOC,KAAP,CAAaF,GAAb;AACAhB,QAAIY,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqBH,IAAII,MAAzB;AACD,GAXH;AAYD,CAnBD;;AAqBAvB,QAAQwB,GAAR,GAAc,UAACtB,GAAD,EAAMC,GAAN,EAAc;AAC1BO,sBAAYe,QAAZ,CAAqBvB,IAAIE,MAAJ,CAAWsB,QAAhC,EACGC,IADH,GAEGd,IAFH,CAEQ,UAACC,MAAD,EAAY;AAChBX,QAAIY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBD,cAAQ,GADW;AAEnBE,YAAMH;AAFa,KAArB;AAID,GAPH,EAQGI,KARH,CAQS,UAACC,GAAD,EAAS;AACdC,qBAAOC,KAAP,CAAaF,GAAb;AACAhB,QAAIY,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqBH,IAAII,MAAzB;AACD,GAXH;AAYD,CAbD;;AAeA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAvB,QAAQ4B,IAAR,GAAe,UAAC1B,GAAD,EAAMC,GAAN,EAAc;AAC3B,MAAMc,OAAOY,OAAOC,MAAP,CAAc,EAAd,EAAkB5B,IAAI6B,IAAtB,KAA+B,EAA5C;;AAEAC,uBAAWC,QAAX,CAAoBC,MAApB,CACEjB,KAAKkB,YADP,EAEE,EAAEC,QAAQ,SAAV,EAFF,EAGE,UAACf,KAAD,EAAQgB,MAAR,EAAmB;AACjB,QAAIhB,KAAJ,EAAW;AACT,aAAOlB,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BK,eAAOA;AADmB,OAArB,CAAP;AAGD;;AAED,QAAIgB,MAAJ,EAAY;AACV;AACApB,WAAKkB,YAAL,GAAoBE,OAAOC,GAA3B;;AAEA5B,0BAAY6B,MAAZ,CAAmBtB,IAAnB,EACGJ,IADH,CACQ,UAACC,MAAD,EAAY;AAChB,eAAOX,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,MAArB,CAAP;AACD,OAHH,EAIGI,KAJH,CAIS,UAACC,GAAD,EAAS;AACdC,yBAAOC,KAAP,CAAaF,GAAb;AACA,eAAOhB,IAAIY,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqBH,GAArB,CAAP;AACD,OAPH;AAQD;AACF,GAvBH;AAyBD,CA5BD;;AA8BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"sermon.js","sourcesContent":["import async from \"async\";\nimport cloudinary from \"../utils/cloudinary\";\nimport { SermonModel } from \"../models\";\n\nimport logger from \"../utils/logger\";\nimport { format } from \"winston\";\n\nexports.list = (req, res) => {\n  const params = req.params || {};\n  const query = req.query || {};\n\n  const page = parseInt(query.page, 10) || 0;\n  const perPage = parseInt(query.per_page, 10) || 10;\n\n  SermonModel.apiQuery(req.query)\n    .select(\"sermon_title sermon_author sermon_content featured_img createdAt updatedAt\")\n    .then((sermon) => {\n      res.status(200).json({\n        status: 200,\n        data: [...sermon],\n      });\n    })\n    .catch((err) => {\n      logger.error(err);\n      res.status(422).send(err.errors);\n    });\n};\n\nexports.get = (req, res) => {\n  SermonModel.findById(req.params.sermonId)\n    .exec()\n    .then((sermon) => {\n      res.status(200).json({\n        status: 200,\n        data: sermon,\n      });\n    })\n    .catch((err) => {\n      logger.error(err);\n      res.status(422).send(err.errors);\n    });\n};\n\n// exports.put = (req, res) => {\n//   const data = req.body || {};\n\n//   if (data.email && !validator.isEmail(data.email)) {\n//     return res.status(422).send(\"Invalid email address.\");\n//   }\n\n//   if (data.username && !validator.isAlphanumeric(data.username)) {\n//     return res.status(422).send(\"Eventsnames must be alphanumeric.\");\n//   }\n\n//   Events.findByIdAndUpdate({ _id: req.params.userId }, data, { new: true })\n//     .then((user) => {\n//       if (!user) {\n//         return res.sendStatus(404);\n//       }\n\n//       user.password = undefined;\n//       user.recoveryCode = undefined;\n\n//       res.json(user);\n//     })\n//     .catch((err) => {\n//       logger.error(err);\n//       res.status(422).send(err.errors);\n//     });\n// };\n\nexports.post = (req, res) => {\n  const data = Object.assign({}, req.body) || {};\n\n  cloudinary.uploader.upload(\n    data.featured_img,\n    { folder: \"sermons\" },\n    (error, result) => {\n      if (error) {\n        return res.status(500).json({\n          error: error,\n        });\n      }\n\n      if (result) {\n        // data.featured_img = result.secure_url;\n        data.featured_img = result.url;\n\n        SermonModel.create(data)\n          .then((sermon) => {\n            return res.status(200).json(sermon);\n          })\n          .catch((err) => {\n            logger.error(err);\n            return res.status(500).send(err);\n          });\n      }\n    }\n  );\n};\n\n// exports.delete = (req, res) => {\n//   Events.findByIdAndUpdate(\n//     { _id: req.params.user },\n//     { active: false },\n//     {\n//       new: true,\n//     }\n//   )\n//     .then((user) => {\n//       if (!user) {\n//         return res.sendStatus(404);\n//       }\n\n//       res.sendStatus(204);\n//     })\n//     .catch((err) => {\n//       logger.error(err);\n//       res.status(422).send(err.errors);\n//     });\n// };\n"]}