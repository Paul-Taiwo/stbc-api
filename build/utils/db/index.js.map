{"version":3,"sources":["../../../src/utils/db/index.js"],"names":["mongoose","Promise","global","connection","connect","config","database","uri","useNewUrlParser","useUnifiedTopology","then","logger","info","env","db","catch","err","message","code","error"],"mappings":";;;;;;AAAA;;;;AAEA;;;;AACA;;;;;;AAEAA,mBAASC,OAAT,GAAmBC,OAAOD,OAA1B;;AAEA,IAAME,aAAaH,mBAASI,OAAT,CAAiBC,iBAAOC,QAAP,CAAgBC,GAAjC,EAAsC;AACvDC,kBAAiB,IADsC;AAEvDC,qBAAoB;AAFmC,CAAtC,CAAnB;;AAKAN,WACEO,IADF,CACO,cAAM;AACXC,kBAAOC,IAAP,gCAC8BP,iBAAOC,QAAP,CAAgBC,GAD9C,4BAEEF,iBAAOQ,GAFT;AAKA,QAAOC,EAAP;AACA,CARF,EASEC,KATF,CASQ,eAAO;AACb,KAAIC,IAAIC,OAAJ,CAAYC,IAAZ,KAAqB,WAAzB,EAAsC;AACrCP,mBAAOC,IAAP,CAAY,iDAAZ;AACAZ,qBAASI,OAAT,CAAiBC,iBAAOC,QAAP,CAAgBC,GAAjC;AACA,EAHD,MAGO;AACNI,mBAAOQ,KAAP,CAAa,gDAAb;AACAR,mBAAOQ,KAAP,CAAaH,GAAb;AACA;AACD,CAjBF;;kBAmBeb,U","file":"index.js","sourcesContent":["import mongoose from 'mongoose';\n\nimport config from '../../config';\nimport logger from '../logger';\n\nmongoose.Promise = global.Promise;\n\nconst connection = mongoose.connect(config.database.uri, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n});\n\nconnection\n\t.then(db => {\n\t\tlogger.info(\n\t\t\t`Successfully connected to ${config.database.uri} MongoDB cluster in ${\n\t\t\t\tconfig.env\n\t\t\t} mode.`,\n\t\t);\n\t\treturn db;\n\t})\n\t.catch(err => {\n\t\tif (err.message.code === 'ETIMEDOUT') {\n\t\t\tlogger.info('Attempting to re-establish database connection.');\n\t\t\tmongoose.connect(config.database.uri);\n\t\t} else {\n\t\t\tlogger.error('Error while attempting to connect to database:');\n\t\t\tlogger.error(err);\n\t\t}\n\t});\n\nexport default connection;\n"]}