{"version":3,"sources":["../../../src/utils/email/index.js"],"names":["email","data","type","Promise","err","logger","error","reject","resolve","config","env","sendgrid","setApiKey","secret","toLowerCase","msg","ejs","render","fs","readFileSync","__dirname","obj","to","from","name","sender","default","subject","content","value","send","then","res","catch","passcode","support"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;;;AAEA,IAAMA,QAAQ,SAARA,KAAQ,OAAQ;AACrB,KAAI,CAACC,KAAKC,IAAN,IAAc,CAACD,KAAKD,KAAxB,EAA+B;AAC9B,SAAO,IAAIG,OAAJ,CAAY,kBAAU;AAC5B,OAAMC,MAAM,kCAAZ;AACAC,oBAAOC,KAAP,CAAaF,GAAb;AACAG,UAAOH,GAAP;AACA,GAJM,CAAP;AAKA;;AAED,QAAO,IAAID,OAAJ,CAAY,UAACK,OAAD,EAAUD,MAAV,EAAqB;AACvC,MAAIE,iBAAOC,GAAP,KAAe,MAAf,IAAyBD,iBAAOC,GAAP,KAAe,OAA5C,EAAqD;AACpD,UAAOF,SAAP;AACA;;AAEDG,iBAASC,SAAT,CAAmBH,iBAAOT,KAAP,CAAaW,QAAb,CAAsBE,MAAzC;AACA,MAAMX,OAAOD,KAAKC,IAAL,CAAUY,WAAV,EAAb;;AAEA,MAAIb,KAAKC,IAAL,KAAc,SAAlB,EAA6B;AAC5B,OAAMa,MAAMC,cAAIC,MAAJ,CACXC,aAAGC,YAAH,CAAgBC,YAAY,wBAA5B,EAAsD,MAAtD,CADW,CAAZ;;AAIA,OAAMC,MAAM;AACXC,QAAIrB,KAAKD,KADE;AAEXuB,UAAM;AACLC,WAAMf,iBAAOT,KAAP,CAAayB,MAAb,CAAoBC,OAApB,CAA4BF,IAD7B;AAELxB,YAAOS,iBAAOT,KAAP,CAAayB,MAAb,CAAoBC,OAApB,CAA4B1B;AAF9B,KAFK;AAMX2B,aAAS,mBANE;AAOXC,aAAS,CACR;AACC1B,WAAM,WADP;AAEC2B,YAAOd;AAFR,KADQ;AAPE,IAAZ;;AAeAJ,kBACEmB,IADF,CACOT,GADP,EAEEU,IAFF,CAEO,eAAO;AACZvB,YAAQwB,GAAR;AACA,IAJF,EAKEC,KALF,CAKQ,eAAO;AACb5B,qBAAOC,KAAP,CAAaF,GAAb;AACAG,WAAOH,GAAP;AACA,IARF;AASA;;AAED,MAAIH,KAAKC,IAAL,KAAc,UAAlB,EAA8B;AAC7B,OAAI,CAACD,KAAKiC,QAAV,EAAoB;AACnB,WAAO,IAAI/B,OAAJ,CAAY,kBAAU;AAC5B,SAAMC,MAAM,wBAAZ;AACAC,sBAAOC,KAAP,CAAaF,GAAb;AACAG,YAAOH,GAAP;AACA,KAJM,CAAP;AAKA;;AAED,OAAMW,OAAMC,cAAIC,MAAJ,CACXC,aAAGC,YAAH,CAAgBC,YAAY,yBAA5B,EAAuD,MAAvD,CADW,EAEX,EAAEc,UAAUjC,KAAKiC,QAAjB,EAFW,CAAZ;;AAKA,OAAMb,OAAM;AACXC,QAAIrB,KAAKD,KADE;AAEXuB,UAAM;AACLC,WAAMf,iBAAOT,KAAP,CAAayB,MAAb,CAAoBU,OAApB,CAA4BX,IAD7B;AAELxB,YAAOS,iBAAOT,KAAP,CAAayB,MAAb,CAAoBU,OAApB,CAA4BnC;AAF9B,KAFK;AAMX2B,aAAS,iBANE;AAOXC,aAAS,CACR;AACC1B,WAAM,WADP;AAEC2B,YAAOd;AAFR,KADQ;AAPE,IAAZ;;AAeAJ,kBACEmB,IADF,CACOT,IADP,EAEEU,IAFF,CAEO,eAAO;AACZvB,YAAQwB,GAAR;AACA,IAJF,EAKEC,KALF,CAKQ,eAAO;AACb5B,qBAAOC,KAAP,CAAaF,GAAb;AACAG,WAAOH,GAAP;AACA,IARF;AASA;AACD,EA9EM,CAAP;AA+EA,CAxFD;;kBA0FeJ,K","file":"index.js","sourcesContent":["import fs from 'fs';\nimport ejs from 'ejs';\nimport sendgrid from '@sendgrid/mail';\n\nimport logger from '../logger';\nimport config from '../../config';\n\nconst email = data => {\n\tif (!data.type || !data.email) {\n\t\treturn new Promise(reject => {\n\t\t\tconst err = 'Missing data.type OR data.email!';\n\t\t\tlogger.error(err);\n\t\t\treject(err);\n\t\t});\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tif (config.env === 'test' || config.env === 'local') {\n\t\t\treturn resolve();\n\t\t}\n\n\t\tsendgrid.setApiKey(config.email.sendgrid.secret);\n\t\tconst type = data.type.toLowerCase();\n\n\t\tif (data.type === 'welcome') {\n\t\t\tconst msg = ejs.render(\n\t\t\t\tfs.readFileSync(__dirname + '/templates/welcome.ejs', 'utf8'),\n\t\t\t);\n\n\t\t\tconst obj = {\n\t\t\t\tto: data.email,\n\t\t\t\tfrom: {\n\t\t\t\t\tname: config.email.sender.default.name,\n\t\t\t\t\temail: config.email.sender.default.email,\n\t\t\t\t},\n\t\t\t\tsubject: 'Welcome to Winds!',\n\t\t\t\tcontent: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'text/html',\n\t\t\t\t\t\tvalue: msg,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\n\t\t\tsendgrid\n\t\t\t\t.send(obj)\n\t\t\t\t.then(res => {\n\t\t\t\t\tresolve(res);\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tlogger.error(err);\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t}\n\n\t\tif (data.type === 'password') {\n\t\t\tif (!data.passcode) {\n\t\t\t\treturn new Promise(reject => {\n\t\t\t\t\tconst err = 'Missing data.passcode!';\n\t\t\t\t\tlogger.error(err);\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst msg = ejs.render(\n\t\t\t\tfs.readFileSync(__dirname + '/templates/password.ejs', 'utf8'),\n\t\t\t\t{ passcode: data.passcode },\n\t\t\t);\n\n\t\t\tconst obj = {\n\t\t\t\tto: data.email,\n\t\t\t\tfrom: {\n\t\t\t\t\tname: config.email.sender.support.name,\n\t\t\t\t\temail: config.email.sender.support.email,\n\t\t\t\t},\n\t\t\t\tsubject: 'Forgot Password',\n\t\t\t\tcontent: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'text/html',\n\t\t\t\t\t\tvalue: msg,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\n\t\t\tsendgrid\n\t\t\t\t.send(obj)\n\t\t\t\t.then(res => {\n\t\t\t\t\tresolve(res);\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tlogger.error(err);\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t}\n\t});\n};\n\nexport default email;\n"]}