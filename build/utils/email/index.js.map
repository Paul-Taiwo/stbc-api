{"version":3,"sources":["../../../src/utils/email/index.js"],"names":["email","data","type","Promise","err","error","reject","resolve","env","setApiKey","sendgrid","secret","toLowerCase","msg","render","readFileSync","__dirname","obj","to","from","name","sender","default","subject","content","value","send","then","res","catch","passcode","support"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;;;AAEA,IAAMA,QAAQ,SAARA,KAAQ,OAAQ;AACrB,KAAI,CAACC,KAAKC,IAAN,IAAc,CAACD,KAAKD,KAAxB,EAA+B;AAC9B,SAAO,IAAIG,OAAJ,CAAY,kBAAU;AAC5B,OAAMC,MAAM,kCAAZ;AACA,oBAAOC,KAAP,CAAaD,GAAb;AACAE,UAAOF,GAAP;AACA,GAJM,CAAP;AAKA;;AAED,QAAO,IAAID,OAAJ,CAAY,UAACI,OAAD,EAAUD,MAAV,EAAqB;AACvC,MAAI,iBAAOE,GAAP,KAAe,MAAf,IAAyB,iBAAOA,GAAP,KAAe,OAA5C,EAAqD;AACpD,UAAOD,SAAP;AACA;;AAED,iBAASE,SAAT,CAAmB,iBAAOT,KAAP,CAAaU,QAAb,CAAsBC,MAAzC;AACA,MAAMT,OAAOD,KAAKC,IAAL,CAAUU,WAAV,EAAb;;AAEA,MAAIX,KAAKC,IAAL,KAAc,SAAlB,EAA6B;AAC5B,OAAMW,MAAM,cAAIC,MAAJ,CACX,aAAGC,YAAH,CAAgBC,YAAY,wBAA5B,EAAsD,MAAtD,CADW,CAAZ;;AAIA,OAAMC,MAAM;AACXC,QAAIjB,KAAKD,KADE;AAEXmB,UAAM;AACLC,WAAM,iBAAOpB,KAAP,CAAaqB,MAAb,CAAoBC,OAApB,CAA4BF,IAD7B;AAELpB,YAAO,iBAAOA,KAAP,CAAaqB,MAAb,CAAoBC,OAApB,CAA4BtB;AAF9B,KAFK;AAMXuB,aAAS,mBANE;AAOXC,aAAS,CACR;AACCtB,WAAM,WADP;AAECuB,YAAOZ;AAFR,KADQ;AAPE,IAAZ;;AAeA,kBACEa,IADF,CACOT,GADP,EAEEU,IAFF,CAEO,eAAO;AACZpB,YAAQqB,GAAR;AACA,IAJF,EAKEC,KALF,CAKQ,eAAO;AACb,qBAAOxB,KAAP,CAAaD,GAAb;AACAE,WAAOF,GAAP;AACA,IARF;AASA;;AAED,MAAIH,KAAKC,IAAL,KAAc,UAAlB,EAA8B;AAC7B,OAAI,CAACD,KAAK6B,QAAV,EAAoB;AACnB,WAAO,IAAI3B,OAAJ,CAAY,kBAAU;AAC5B,SAAMC,MAAM,wBAAZ;AACA,sBAAOC,KAAP,CAAaD,GAAb;AACAE,YAAOF,GAAP;AACA,KAJM,CAAP;AAKA;;AAED,OAAMS,OAAM,cAAIC,MAAJ,CACX,aAAGC,YAAH,CAAgBC,YAAY,yBAA5B,EAAuD,MAAvD,CADW,EAEX,EAAEc,UAAU7B,KAAK6B,QAAjB,EAFW,CAAZ;;AAKA,OAAMb,OAAM;AACXC,QAAIjB,KAAKD,KADE;AAEXmB,UAAM;AACLC,WAAM,iBAAOpB,KAAP,CAAaqB,MAAb,CAAoBU,OAApB,CAA4BX,IAD7B;AAELpB,YAAO,iBAAOA,KAAP,CAAaqB,MAAb,CAAoBU,OAApB,CAA4B/B;AAF9B,KAFK;AAMXuB,aAAS,iBANE;AAOXC,aAAS,CACR;AACCtB,WAAM,WADP;AAECuB,YAAOZ;AAFR,KADQ;AAPE,IAAZ;;AAeA,kBACEa,IADF,CACOT,IADP,EAEEU,IAFF,CAEO,eAAO;AACZpB,YAAQqB,GAAR;AACA,IAJF,EAKEC,KALF,CAKQ,eAAO;AACb,qBAAOxB,KAAP,CAAaD,GAAb;AACAE,WAAOF,GAAP;AACA,IARF;AASA;AACD,EA9EM,CAAP;AA+EA,CAxFD;;kBA0FeJ,K","file":"index.js","sourcesContent":["import fs from 'fs';\nimport ejs from 'ejs';\nimport sendgrid from '@sendgrid/mail';\n\nimport logger from '../logger';\nimport config from '../../config';\n\nconst email = data => {\n\tif (!data.type || !data.email) {\n\t\treturn new Promise(reject => {\n\t\t\tconst err = 'Missing data.type OR data.email!';\n\t\t\tlogger.error(err);\n\t\t\treject(err);\n\t\t});\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tif (config.env === 'test' || config.env === 'local') {\n\t\t\treturn resolve();\n\t\t}\n\n\t\tsendgrid.setApiKey(config.email.sendgrid.secret);\n\t\tconst type = data.type.toLowerCase();\n\n\t\tif (data.type === 'welcome') {\n\t\t\tconst msg = ejs.render(\n\t\t\t\tfs.readFileSync(__dirname + '/templates/welcome.ejs', 'utf8'),\n\t\t\t);\n\n\t\t\tconst obj = {\n\t\t\t\tto: data.email,\n\t\t\t\tfrom: {\n\t\t\t\t\tname: config.email.sender.default.name,\n\t\t\t\t\temail: config.email.sender.default.email,\n\t\t\t\t},\n\t\t\t\tsubject: 'Welcome to Winds!',\n\t\t\t\tcontent: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'text/html',\n\t\t\t\t\t\tvalue: msg,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\n\t\t\tsendgrid\n\t\t\t\t.send(obj)\n\t\t\t\t.then(res => {\n\t\t\t\t\tresolve(res);\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tlogger.error(err);\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t}\n\n\t\tif (data.type === 'password') {\n\t\t\tif (!data.passcode) {\n\t\t\t\treturn new Promise(reject => {\n\t\t\t\t\tconst err = 'Missing data.passcode!';\n\t\t\t\t\tlogger.error(err);\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst msg = ejs.render(\n\t\t\t\tfs.readFileSync(__dirname + '/templates/password.ejs', 'utf8'),\n\t\t\t\t{ passcode: data.passcode },\n\t\t\t);\n\n\t\t\tconst obj = {\n\t\t\t\tto: data.email,\n\t\t\t\tfrom: {\n\t\t\t\t\tname: config.email.sender.support.name,\n\t\t\t\t\temail: config.email.sender.support.email,\n\t\t\t\t},\n\t\t\t\tsubject: 'Forgot Password',\n\t\t\t\tcontent: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'text/html',\n\t\t\t\t\t\tvalue: msg,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\n\t\t\tsendgrid\n\t\t\t\t.send(obj)\n\t\t\t\t.then(res => {\n\t\t\t\t\tresolve(res);\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tlogger.error(err);\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t}\n\t});\n};\n\nexport default email;\n"]}